{"version":3,"sources":["../src/ctrl.js"],"names":["MetricsPanelCtrl","$","angular","kbn","FileExport","DataTable","transformDataToTable","transformers","DatatableRenderer","panelDefaults","targets","transform","rowsPerPage","showHeader","styles","type","pattern","dateFormat","unit","decimals","colors","colorMode","thresholds","columns","groupBy","scroll","scrollHeight","fontSize","sort","col","desc","sortDirection","datatableTheme","themeOptions","light","dark","rowNumbersEnabled","infoEnabled","searchEnabled","showCellBorders","showRowBorders","hoverEnabled","orderColumnEnabled","compactRowsEnabled","stripedRowsEnabled","lengthChangeEnabled","datatablePagingType","pagingTypes","text","value","themes","disabled","responsive","enable","hiddenColumns","editor","create","edit","editSingle","remove","removeSingle","buttons","collection","columnsToggle","columnsVisibility","columnToggle","columnVisibility","colvis","colvisGroup","colvisRestore","copy","copyHtml5","print","pageLength","csv","csvHtml5","excel","excelHtml5","pdf","pdfHtml5","selectAll","selectNone","selectCells","selectColumns","selectRows","DatatablePanelCtrl","$scope","$injector","$http","$location","uiSegmentSrv","annotationsSrv","pageIndex","table","dataRaw","addColumnSegment","newPlusButton","addGroupBySegment","addHiddenColumnBySegment","fontSizes","colorModes","columnTypes","unitFormats","getUnitFormats","dateFormats","sortDirections","getColumnNames","_","map","panel","fields","defaults","System","config","paths","getPanelPath","import","grafanaBootData","user","lightTheme","dataLoaded","http","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","actions","push","click","panels","settings","thisPanel","pluginId","thisPanelPath","baseUrl","optionsPath","addEditorTab","datatableOptionsPath","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","data","annotations","err","render","dataList","length","tmpPanelHeight","ctrl","height","row","replace","actualHeight","parseInt","renderer","isTimezoneUtc","$sanitize","get","exportTableDataToCsv","render_values","scope","elem","attrs","formatters","_this","renderPanel","panelHeight","getPanelHeight","renderData","renderingCompleted","column","without","$q","when","getColumns","segments","c","newSegment","find","plusButton","html","columnStyleDefaults","style","subItem","index","ref","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,4B,kBAAAA,gB;;AACDC,a;;AACAC,mB;;AACAC,e;;AAEKC,sB;;AACLC,qB;;AAmDHC,gC,iBAAAA,oB;AACAC,wB,iBAAAA,Y;;AAGIC,6B,aAAAA,iB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEFC,yB,GAAgB;AAClBC,yBAAS,CAAC,EAAD,CADS;AAElBC,2BAAW,uBAFO;AAGlBC,6BAAa,CAHK;AAIlBC,4BAAY,IAJM;AAKlBC,wBAAQ,CACJ;AACIC,0BAAM,MADV;AAEIC,6BAAS,MAFb;AAGIC,gCAAY;AAHhB,iBADI,EAMJ;AACIC,0BAAM,OADV;AAEIH,0BAAM,QAFV;AAGII,8BAAU,CAHd;AAIIC,4BAAQ,CAAC,wBAAD,EAA2B,0BAA3B,EAAuD,yBAAvD,CAJZ;AAKIC,+BAAW,IALf;AAMIL,6BAAS,MANb;AAOIM,gCAAY;AAPhB,iBANI,CALU;AAqBlBC,yBAAS,EArBS;AAsBlBC,yBAAS,EAtBS;AAuBlBC,wBAAQ,KAvBU;AAwBlBC,8BAAc,SAxBI;AAyBlBC,0BAAU,MAzBQ;AA0BlBC,sBAAM;AACFC,yBAAK,CADH;AAEFC,0BAAM;AAFJ,iBA1BY;AA8BlBC,+BAAe,MA9BG;AA+BlBC,gCAAgB,aA/BE;AAgClBC,8BAAc;AACVC,2BAAO,2BADG;AAEVC,0BAAM;AAFI,iBAhCI;AAoClBC,mCAAmB,KApCD;AAqClBC,6BAAa,IArCK;AAsClBC,+BAAe,IAtCG;AAuClBC,iCAAiB,KAvCC;AAwClBC,gCAAgB,IAxCE;AAyClBC,8BAAc,IAzCI;AA0ClBC,oCAAoB,IA1CF;AA2ClBC,oCAAoB,KA3CF;AA4ClBC,oCAAoB,IA5CF;AA6ClBC,qCAAqB,IA7CH;AA8ClBC,qCAAqB,gBA9CH;AA+ClBC,6BAAa,CACT;AACIC,0BAAM,0BADV;AAEIC,2BAAO;AAFX,iBADS,EAKT;AACID,0BAAM,oCADV;AAEIC,2BAAO;AAFX,iBALS,EAST;AACID,0BAAM,kDADV;AAEIC,2BAAO;AAFX,iBATS,EAaT;AACID,0BAAM,gDADV;AAEIC,2BAAO;AAFX,iBAbS,EAiBT;AACID,0BAAM,mEADV;AAEIC,2BAAO;AAFX,iBAjBS,EAqBT;AACID,0BAAM,+CADV;AAEIC,2BAAO;AAFX,iBArBS,CA/CK;AAyElBC,wBAAQ,CACJ;AACID,2BAAO,aADX;AAEID,0BAAM,OAFV;AAGIG,8BAAU;AAHd,iBADI,EAMJ;AACIF,2BAAO,iBADX;AAEID,0BAAM,WAFV;AAGIG,8BAAU;AAHd,iBANI,EAWJ;AACIF,2BAAO,kBADX;AAEID,0BAAM,YAFV;AAGIG,8BAAU;AAHd,iBAXI,EAgBJ;AACIF,2BAAO,mBADX;AAEID,0BAAM,aAFV;AAGIG,8BAAU;AAHd,iBAhBI,CAzEU;AA+FlBC,4BAAY;AACRC,4BAAQ,KADA;AAERC,mCAAe;AAFP,iBA/FM;AAmGlBC,wBAAQ;AACJF,4BAAQ,KADJ;AAEJG,4BAAQ,KAFJ;AAGJC,0BAAM,KAHF;AAIJC,gCAAY,KAJR;AAKJC,4BAAQ,KALJ;AAMJC,kCAAc;AANV,iBAnGU;AA2GlBC,yBAAS;AACLC,gCAAY,KADP;AAELC,mCAAe,KAFV;AAGLC,uCAAmB,KAHd;AAILC,kCAAc,KAJT;AAKLC,sCAAkB,KALb;AAMLC,4BAAQ,KANH;AAOLC,iCAAa,KAPR;AAQLC,mCAAe,KARV;AASLC,0BAAM,KATD;AAULC,+BAAW,KAVN;AAWLC,2BAAO,KAXF;AAYLC,gCAAY,KAZP;AAaLC,yBAAK,KAbA;AAcLC,8BAAU,KAdL;AAeLC,2BAAO,KAfF;AAgBLC,gCAAY,KAhBP;AAiBLC,yBAAK,KAjBA;AAkBLC,8BAAU,KAlBL;AAmBLC,+BAAW,KAnBN;AAoBLC,gCAAY,KApBP;AAqBLC,iCAAa,KArBR;AAsBLC,mCAAe,KAtBV;AAuBLC,gCAAY;AAvBP;AA3GS,a;;0CAsITC,kB;;;AAET,4CAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,KAA/B,EAAsCC,SAAtC,EAAiDC,YAAjD,EAA+DC,cAA/D,EAA+E;AAAA;;AAAA,yJACrEL,MADqE,EAC7DC,SAD6D;;AAG3E,2BAAKK,SAAL,GAAiB,CAAjB;AACA,2BAAKC,KAAL,GAAa,IAAb;AACA,2BAAKC,OAAL,GAAe,EAAf;AACA,2BAAKvF,YAAL,GAAoBA,YAApB;AACA,2BAAKoF,cAAL,GAAsBA,cAAtB;AACA,2BAAKD,YAAL,GAAoBA,YAApB;AACA;;AAEA,2BAAKK,gBAAL,GAAwBL,aAAaM,aAAb,EAAxB;AACA,2BAAKC,iBAAL,GAAyBP,aAAaM,aAAb,EAAzB;AACA,2BAAKE,wBAAL,GAAgCR,aAAaM,aAAb,EAAhC;AACA,2BAAKG,SAAL,GAAiB,CAAC,KAAD,EAAQ,KAAR,EAAe,MAAf,EAAuB,MAAvB,EAA+B,MAA/B,EAAuC,MAAvC,EAA+C,MAA/C,EAAuD,MAAvD,EAA+D,MAA/D,EAAuE,MAAvE,EAA+E,MAA/E,EAAuF,MAAvF,CAAjB;AACA,2BAAKC,UAAL,GAAkB,CACd;AACIpD,8BAAM,UADV;AAEIC,+BAAO;AAFX,qBADc,EAKd;AACID,8BAAM,MADV;AAEIC,+BAAO;AAFX,qBALc,EASd;AACID,8BAAM,OADV;AAEIC,+BAAO;AAFX,qBATc,EAad;AACID,8BAAM,KADV;AAEIC,+BAAO;AAFX,qBAbc,EAiBd;AACID,8BAAM,YADV;AAEIC,+BAAO;AAFX,qBAjBc,CAAlB;AAsBA,2BAAKoD,WAAL,GAAmB,CACf;AACIrD,8BAAM,QADV;AAEIC,+BAAO;AAFX,qBADe,EAKf;AACID,8BAAM,QADV;AAEIC,+BAAO;AAFX,qBALe,EASf;AACID,8BAAM,MADV;AAEIC,+BAAO;AAFX,qBATe,EAaf;AACID,8BAAM,QADV;AAEIC,+BAAO;AAFX,qBAbe,CAAnB;AAkBA,2BAAKqD,WAAL,GAAmBnG,IAAIoG,cAAJ,EAAnB;AACA,2BAAKC,WAAL,GAAmB,CACf;AACIxD,8BAAM,qBADV;AAEIC,+BAAO;AAFX,qBADe,EAKf;AACID,8BAAM,oBADV;AAEIC,+BAAO;AAFX,qBALe,EASf;AACID,8BAAM,iBADV;AAEIC,+BAAO;AAFX,qBATe,CAAnB;AAcA,2BAAKwD,cAAL,GAAsB,CAAC,MAAD,EAAS,KAAT,CAAtB;AACA;AACA,2BAAKC,cAAL,GAAsB,YAAM;AACxB,4BAAI,CAAC,OAAKb,KAAV,EAAiB;AACb,mCAAO,EAAP;AACH;AACD,+BAAOc,EAAEC,GAAF,CAAM,OAAKf,KAAL,CAAWtE,OAAjB,EAA0B,UAAUM,GAAV,EAAe;AAC5C,mCAAOA,IAAImB,IAAX;AACH,yBAFM,CAAP;AAGH,qBAPD;;AASA,wBAAI,OAAK6D,KAAL,CAAW/F,MAAX,KAAsB,KAAK,CAA/B,EAAkC;AAC9B,+BAAK+F,KAAL,CAAW/F,MAAX,GAAoB,OAAK+F,KAAL,CAAWtF,OAA/B;AACA,+BAAKsF,KAAL,CAAWtF,OAAX,GAAqB,OAAKsF,KAAL,CAAWC,MAAhC;AACA,+BAAO,OAAKD,KAAL,CAAWtF,OAAlB;AACA,+BAAO,OAAKsF,KAAL,CAAWC,MAAlB;AACH;AACDH,sBAAEI,QAAF,CAAW,OAAKF,KAAhB,EAAuBpG,aAAvB;;AAEAuG,2BAAOC,MAAP,CAAc;AACVC,+BAAO;AACH,8CAAkB,OAAKC,YAAL,KAAsB,8CADrC;AAEH,iDAAqB,OAAKA,YAAL,KAAsB,oDAFxC;AAGH,mDAAuB,OAAKA,YAAL,KAAsB,qDAH1C;AAIH,iDAAqB,OAAKA,YAAL,KAAsB,qDAJxC;AAKH,yDAA6B,OAAKA,YAAL,KAAsB,6DALhD;AAMH,sDAA0B,OAAKA,YAAL,KAAsB;AAN7C;AADG,qBAAd;;AAWAH,2BAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,gEAApC;AACAH,2BAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,0DAApC;AACAH,2BAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,sDAApC;AACAH,2BAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,qDAApC;AACAH,2BAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,qDAApC;AACAH,2BAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,wDAApC;;AAEA;AACA;AACA,4BAAQ,OAAKN,KAAL,CAAW7E,cAAnB;AACI,6BAAK,aAAL;AACIgF,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,uDAApC;AACAH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,sEAApC;AACAH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,gEAApC;;AAEA,gCAAIE,gBAAgBC,IAAhB,CAAqBC,UAAzB,EAAqC;AACjCP,uCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,OAAKN,KAAL,CAAW5E,YAAX,CAAwBC,KAA9C,GAAsD,MAApE;AACH,6BAFD,MAEO;AACH8E,uCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,OAAKN,KAAL,CAAW5E,YAAX,CAAwBE,IAA9C,GAAqD,MAAnE;AACH;AACD;AACJ,6BAAK,iBAAL;AACI6E,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,uDAApC;AACAH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,qDAApC;AACAH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,0DAApC;AACA,gCAAI,CAACE,gBAAgBC,IAAhB,CAAqBC,UAA1B,EAAsC;AAClCP,uCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,uCAApC;AACH;AACD;AACJ,6BAAK,kBAAL;AACIH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,wDAApC;AACAH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,kDAApC;AACAH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,2DAApC;AACA;AACJ,6BAAK,mBAAL;AACIH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,wDAApC;AACAH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,2DAApC;AACAH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,+BAApC;AACA;AACJ;AACIH,mCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,uDAApC;AACA,gCAAIE,gBAAgBC,IAAhB,CAAqBC,UAAzB,EAAqC;AACjCP,uCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,OAAKN,KAAL,CAAW5E,YAAX,CAAwBC,KAA9C,GAAsD,MAApE;AACH,6BAFD,MAEO;AACH8E,uCAAOI,MAAP,CAAc,OAAKD,YAAL,KAAsB,OAAKN,KAAL,CAAW5E,YAAX,CAAwBE,IAA9C,GAAqD,MAAnE;AACH;AACD;AArCR;AAuCA,2BAAKqF,UAAL,GAAkB,IAAlB;AACA,2BAAKC,IAAL,GAAYjC,KAAZ;AACA,2BAAKkC,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,OAAKC,cAAL,CAAoBC,IAApB,QAAhC;AACA,2BAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,OAAKG,WAAL,CAAiBD,IAAjB,QAA7B;AACA,2BAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,OAAKC,cAAL,CAAoBC,IAApB,QAArC;AACA,2BAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,OAAKI,cAAL,CAAoBF,IAApB,QAAjC;AACA,2BAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,OAAKK,kBAAL,CAAwBH,IAAxB,QAArC;AA1J2E;AA2J9E;;;;uDAEkBI,O,EAAS;AACxBA,gCAAQC,IAAR,CAAa;AACTlF,kCAAM,YADG;AAETmF,mCAAO;AAFE,yBAAb;AAIH;;;qDAGgB;AACb;AACA,4BAAIC,SAASf,gBAAgBgB,QAAhB,CAAyBD,MAAtC;AACA,4BAAIE,YAAYF,OAAO,KAAKG,QAAZ,CAAhB;AACA,4BAAIC,gBAAgBF,UAAUG,OAAV,GAAoB,GAAxC;AACA;AACA,4BAAIC,cAAcF,gBAAgB,8BAAlC;AACA,6BAAKG,YAAL,CAAkB,SAAlB,EAA6BD,WAA7B,EAA0C,CAA1C;AACA,4BAAIE,uBAAuBJ,gBAAgB,kCAA3C;AACA,6BAAKG,YAAL,CAAkB,mBAAlB,EAAuCC,oBAAvC,EAA6D,CAA7D;AACH;;;mDAEc;AACX,4BAAIR,SAASf,gBAAgBgB,QAAhB,CAAyBD,MAAtC;AACA,4BAAIE,YAAYF,OAAO,KAAKG,QAAZ,CAAhB;AACA;AACA,4BAAIC,gBAAgB,QAAQF,UAAUG,OAAlB,GAA4B,GAAhD;AACA,+BAAOD,aAAP;AACH;;;iDAEYK,U,EAAY;AACrB,6BAAKjD,SAAL,GAAiB,CAAjB;AACA,4BAAI,KAAKiB,KAAL,CAAWlG,SAAX,KAAyB,aAA7B,EAA4C;AACxC,iCAAKmI,iBAAL;AACA,mCAAO,KAAKnD,cAAL,CAAoBoD,cAApB,CAAmC;AACtCC,2CAAW,KAAKA,SADsB;AAEtCnC,uCAAO,KAAKA,KAF0B;AAGtCoC,uCAAO,KAAKA;AAH0B,6BAAnC,EAKFC,IALE,CAKG,uBAAe;AACjB,uCAAO;AACHC,0CAAMC;AADH,iCAAP;AAGH,6BATE,CAAP;AAUH;AACD,oKAA0BP,UAA1B;AACH;;;gDAEWQ,G,EAAK;AACb,6BAAKvD,OAAL,GAAe,EAAf;AACA,6BAAKwD,MAAL;AACH;;;mDAEcC,Q,EAAU;AACrB,6BAAKzD,OAAL,GAAeyD,QAAf;AACA,6BAAK3D,SAAL,GAAiB,CAAjB;;AAEA;AACA,4BAAI,KAAKE,OAAL,IAAgB,KAAKA,OAAL,CAAa0D,MAAjC,EAAyC;AACrC,gCAAI,KAAK1D,OAAL,CAAa,CAAb,EAAgB/E,IAAhB,KAAyB,OAA7B,EAAsC;AAClC,qCAAK8F,KAAL,CAAWlG,SAAX,GAAuB,OAAvB;AACH,6BAFD,MAEO;AACH,oCAAI,KAAKmF,OAAL,CAAa,CAAb,EAAgB/E,IAAhB,KAAyB,MAA7B,EAAqC;AACjC,yCAAK8F,KAAL,CAAWlG,SAAX,GAAuB,MAAvB;AACH,iCAFD,MAEO;AACH,wCAAI,KAAKkG,KAAL,CAAWlG,SAAX,KAAyB,OAAzB,IAAoC,KAAKkG,KAAL,CAAWlG,SAAX,KAAyB,MAAjE,EAAyE;AACrE,6CAAKkG,KAAL,CAAWlG,SAAX,GAAuB,oBAAvB;AACH;AACJ;AACJ;AACJ;AACD,6BAAK2I,MAAL;AACH;;;6CAEQ;AACL,6BAAKzD,KAAL,GAAavF,qBAAqB,KAAKwF,OAA1B,EAAmC,KAAKe,KAAxC,CAAb;AACA,6BAAKhB,KAAL,CAAWjE,IAAX,CAAgB,KAAKiF,KAAL,CAAWjF,IAA3B;AACA,8JAAoB,KAAKiE,KAAzB;AACH;;;qDAEgB;AACb;AACA,4BAAI4D,iBAAiB,KAAKnE,MAAL,CAAYoE,IAAZ,CAAiB7C,KAAjB,CAAuB8C,MAA5C;AACA;AACA,4BAAI,OAAOF,cAAP,KAA0B,WAA9B,EAA2C;AACvC;AACAA,6CAAiB,KAAKG,GAAL,CAASD,MAA1B;AACA;AACA,gCAAI,OAAOF,cAAP,KAA0B,WAA9B,EAA2C;AACvCA,iDAAiB,GAAjB;AACH;AACJ,yBAPD,MAQK;AACD;AACAA,6CAAiBA,eAAeI,OAAf,CAAuB,IAAvB,EAA6B,EAA7B,CAAjB;AACH;AACD,4BAAIC,eAAeC,SAASN,cAAT,CAAnB;AACA;AACA,4BAAIK,eAAe,GAAnB,EAAwB;AACpBA,2CAAe,GAAf;AACH;AACD,+BAAOA,YAAP;AACH;;;gDAEW;AACR,4BAAIE,WAAW,IAAIxJ,iBAAJ,CAAsB,KAAKqG,KAA3B,EAAkC,KAAKhB,KAAvC,EAA8C,KAAKmD,SAAL,CAAeiB,aAAf,EAA9C,EAA8E,KAAKC,SAAnF,EAA8F,KAAK3E,SAAL,CAAe4E,GAAf,CAAmB,SAAnB,CAA9F,CAAf;AACA/J,mCAAWgK,oBAAX,CAAgCJ,SAASK,aAAT,EAAhC;AACH;;;yCAEIC,K,EAAOC,I,EAAMC,K,EAAOd,I,EAAM;AAC3B,4BAAIP,IAAJ;AACA,4BAAItC,QAAQ6C,KAAK7C,KAAjB;AACA,4BAAI4D,aAAa,EAAjB;AACA,4BAAIC,QAAQ,IAAZ;;AAEA;;;;AAIA,iCAASC,WAAT,GAAuB;AACnB,gCAAIX,WAAW,IAAIxJ,iBAAJ,CAAsBqG,KAAtB,EAA6B6C,KAAK7D,KAAlC,EAAyC6D,KAAKV,SAAL,CAAeiB,aAAf,EAAzC,EAAyEP,KAAKQ,SAA9E,EAAyFR,KAAKnE,SAAL,CAAe4E,GAAf,CAAmB,SAAnB,CAAzF,CAAf;AACAH,qCAASV,MAAT;AACAoB,kCAAMlD,UAAN,GAAmB,IAAnB;AACH;;AAEDkC,6BAAK7C,KAAL,CAAW+D,WAAX,GAAyB,KAAKC,cAAL,EAAzB;AACAnB,6BAAKhC,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,UAAUmD,UAAV,EAAsB;AAC3C3B,mCAAO2B,cAAc3B,IAArB;AACA,gCAAIA,IAAJ,EAAU;AACNwB;AACH;AACDjB,iCAAKqB,kBAAL;AACH,yBAND;AAOH;;;6DAKwB;AACrB,4BAAI,KAAKlE,KAAL,CAAWtE,eAAf,EAAgC;AAC5B,iCAAKsE,KAAL,CAAWrE,cAAX,GAA4B,KAA5B;AACH;AACD,6BAAK8G,MAAL;AACH;;;mDAEc;AACX;AACA,6BAAKA,MAAL;AACH;;;uDAEkB;AACf,6BAAKzC,KAAL,CAAWtF,OAAX,GAAqB,EAArB;AACA,6BAAKsF,KAAL,CAAWrF,OAAX,GAAqB,EAArB;AACA,6BAAK8H,MAAL;AACH;;;iDAEY0B,M,EAAQ;AACjB,6BAAKnE,KAAL,CAAWtF,OAAX,GAAqBoF,EAAEsE,OAAF,CAAU,KAAKpE,KAAL,CAAWtF,OAArB,EAA8ByJ,MAA9B,CAArB;AACA,6BAAK1B,MAAL;AACH;;;kDAEa0B,M,EAAQ;AAClB,6BAAKnE,KAAL,CAAWrF,OAAX,GAAqBmF,EAAEsE,OAAF,CAAU,KAAKpE,KAAL,CAAWrF,OAArB,EAA8BwJ,MAA9B,CAArB;AACA,6BAAK1B,MAAL;AACH;;;wDAEmB0B,M,EAAQ;AACxB,6BAAKnE,KAAL,CAAWzD,UAAX,CAAsBE,aAAtB,GAAsCqD,EAAEsE,OAAF,CAAU,KAAKpE,KAAL,CAAWzD,UAAX,CAAsBE,aAAhC,EAA+C0H,MAA/C,CAAtC;AACA,6BAAK1B,MAAL;AACH;;;uDAEkB;AAAA;;AACf,4BAAI,CAAC,KAAKxD,OAAV,EAAmB;AACf,mCAAO,KAAKoF,EAAL,CAAQC,IAAR,CAAa,EAAb,CAAP;AACH;AACD,4BAAI5J,UAAU,KAAKhB,YAAL,CAAkB,KAAKsG,KAAL,CAAWlG,SAA7B,EAAwCyK,UAAxC,CAAmD,KAAKtF,OAAxD,CAAd;AACA,4BAAIuF,WAAW1E,EAAEC,GAAF,CAAMrF,OAAN,EAAe,UAAC+J,CAAD;AAAA,mCAAO,OAAK5F,YAAL,CAAkB6F,UAAlB,CAA6B;AAC9DtI,uCAAOqI,EAAEtI;AADqD,6BAA7B,CAAP;AAAA,yBAAf,CAAf;AAGA,+BAAO,KAAKkI,EAAL,CAAQC,IAAR,CAAaE,QAAb,CAAP;AACH;;;gDAEW;AACR,4BAAI9J,UAAUhB,aAAa,KAAKsG,KAAL,CAAWlG,SAAxB,EAAmCyK,UAAnC,CAA8C,KAAKtF,OAAnD,CAAd;AACA,4BAAIkF,SAASrE,EAAE6E,IAAF,CAAOjK,OAAP,EAAgB;AACzByB,kCAAM,KAAK+C,gBAAL,CAAsB9C;AADH,yBAAhB,CAAb;;AAIA,4BAAI+H,MAAJ,EAAY;AACR,iCAAKnE,KAAL,CAAWtF,OAAX,CAAmB2G,IAAnB,CAAwB8C,MAAxB;AAEH,yBAHD,MAGO;AACH,iCAAKnE,KAAL,CAAWtF,OAAX,CAAmB2G,IAAnB,CAAwB,EAAClF,MAAM,KAAK+C,gBAAL,CAAsB9C,KAA7B,EAAoCA,OAAO,KAAK8C,gBAAL,CAAsB9C,KAAjE,EAAxB;AACH;AACD,6BAAKqG,MAAL;;AAEA,4BAAImC,aAAa,KAAK/F,YAAL,CAAkBM,aAAlB,EAAjB;AACA,6BAAKD,gBAAL,CAAsB2F,IAAtB,GAA6BD,WAAWC,IAAxC;AACA,6BAAK3F,gBAAL,CAAsB9C,KAAtB,GAA8BwI,WAAWxI,KAAzC;AACH;;;iDAEY;AACT,4BAAI1B,UAAUhB,aAAa,KAAKsG,KAAL,CAAWlG,SAAxB,EAAmCyK,UAAnC,CAA8C,KAAKtF,OAAnD,CAAd;AACA,4BAAIkF,SAASrE,EAAE6E,IAAF,CAAOjK,OAAP,EAAgB;AACzByB,kCAAM,KAAKiD,iBAAL,CAAuBhD;AADJ,yBAAhB,CAAb;;AAIA,4BAAI+H,MAAJ,EAAY;AACR,iCAAKnE,KAAL,CAAWrF,OAAX,CAAmB0G,IAAnB,CAAwB8C,MAAxB;AACA,iCAAK1B,MAAL;AACH;;AAED,4BAAImC,aAAa,KAAK/F,YAAL,CAAkBM,aAAlB,EAAjB;AACA,6BAAKC,iBAAL,CAAuByF,IAAvB,GAA8BD,WAAWC,IAAzC;AACA,6BAAKzF,iBAAL,CAAuBhD,KAAvB,GAA+BwI,WAAWxI,KAA1C;AACH;;;sDAEiB;AACd,4BAAI1B,UAAUhB,aAAa,KAAKsG,KAAL,CAAWlG,SAAxB,EAAmCyK,UAAnC,CAA8C,KAAKtF,OAAnD,CAAd;AACA,4BAAIkF,SAASrE,EAAE6E,IAAF,CAAOjK,OAAP,EAAgB;AACzByB,kCAAM,KAAKkD,wBAAL,CAA8BjD;AADX,yBAAhB,CAAb;;AAIA,4BAAI+H,MAAJ,EAAY;AACR,iCAAKnE,KAAL,CAAWzD,UAAX,CAAsBE,aAAtB,CAAoC4E,IAApC,CAAyC8C,MAAzC;AACA,iCAAK1B,MAAL;AACH;;AAED,4BAAImC,aAAa,KAAK/F,YAAL,CAAkBM,aAAlB,EAAjB;AACA,6BAAKE,wBAAL,CAA8BwF,IAA9B,GAAqCD,WAAWC,IAAhD;AACA,6BAAKxF,wBAAL,CAA8BjD,KAA9B,GAAsCwI,WAAWxI,KAAjD;AACH;;;qDAEgB;AACb,4BAAI0I,sBAAsB;AACtBzK,kCAAM,OADgB;AAEtBH,kCAAM,QAFgB;AAGtBI,sCAAU,CAHY;AAItBC,oCAAQ,CAAC,wBAAD,EAA2B,0BAA3B,EAAuD,yBAAvD,CAJc;AAKtBC,uCAAW,IALW;AAMtBL,qCAAS,MANa;AAOtBC,wCAAY,qBAPU;AAQtBK,wCAAY;AARU,yBAA1B;AAUA,6BAAKuF,KAAL,CAAW/F,MAAX,CAAkBoH,IAAlB,CAAuBhI,QAAQoE,IAAR,CAAaqH,mBAAb,CAAvB;AACH;;;sDAEiBC,K,EAAO;AACrB,6BAAK/E,KAAL,CAAW/F,MAAX,GAAoB6F,EAAEsE,OAAF,CAAU,KAAKpE,KAAL,CAAW/F,MAArB,EAA6B8K,KAA7B,CAApB;AACH;;;kDAEaZ,M,EAAQa,O,EAAS;AAC3Bb,+BAAO9J,IAAP,GAAc2K,QAAQ5I,KAAtB;AACA,6BAAKqG,MAAL;AACH;;;qDAEgBwC,K,EAAO;AACpB,4BAAIC,MAAM,KAAKlF,KAAL,CAAW/F,MAAX,CAAkBgL,KAAlB,EAAyB1K,MAAnC;AACA,4BAAIkD,OAAOyH,IAAI,CAAJ,CAAX;AACAA,4BAAI,CAAJ,IAASA,IAAI,CAAJ,CAAT;AACAA,4BAAI,CAAJ,IAASzH,IAAT;AACA,6BAAKgF,MAAL;AACH;;;;cAnamCtJ,gB;;;;AAsaxCqF,+BAAmB2G,WAAnB,GAAiC,wBAAjC","file":"ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport $ from 'jquery';\r\nimport angular from 'angular';\r\nimport kbn from 'app/core/utils/kbn';\r\n\r\nimport * as FileExport from 'app/core/utils/file_export';\r\nimport DataTable from './libs/datatables.net/js/jquery.dataTables.min.js';\r\n\r\n// this is needed for basic datatables.net theme\r\n//import './libs/datatables.net-dt/css/jquery.dataTables.min.css!';\r\n\r\n// See this for styling https://datatables.net/manual/styling/theme-creator\r\n\r\n/*\r\nDark Theme Basic uses these values\r\n\r\ntable section border: #242222 rgb(36,34,34)\r\nrow/cell border: #141414 rgb(20,20,20)\r\nrow background: #1F1D1D  rgb(31,29,29)\r\nrow selected color:  #242222 rgb(36,34,34)\r\ncontrol text: #1FB2E5 rgb(31,178,229)\r\ncontrol text: white  (dataTables_paginate)\r\npaging active button: #242222 rgb(36,34,34)\r\npaging button hover: #111111 rgb(17,17,17)\r\n\r\nwith these modifications:\r\n.dataTables_wrapper .dataTables_paginate .paginate_button {\r\n  color: white\r\n}\r\ntable.dataTable tfoot th {\r\n  color: #1FB2E5;\r\n  font-weight: bold; }\r\n\r\n\r\nLight Theme Basic uses these values\r\n\r\ntable section border: #ECECEC rgb(236,236,236)\r\nrow/cell border: #FFFFFF rgb(255,255,255)\r\nrow background: #FBFBFB  rgb(251,251,251)\r\nrow selected color:  #ECECEC rgb(236,236,236)\r\ncontrol text: black\r\npaging active button: #BEBEBE\r\npaging button hover: #C0C0C0\r\n\r\nwith these modifications:\r\n.dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {\r\n  color: #1fb2e5 !important;\r\ntable.dataTable tfoot th {\r\n  color: #1FB2E5;\r\n  font-weight: bold; }\r\n*/\r\n\r\nimport './css/panel.css!';\r\n// themes attempt to modify the entire page, this \"contains\" the styling to the table only\r\nimport './css/datatables-wrapper.css!';\r\n\r\nimport {\r\n    transformDataToTable,\r\n    transformers\r\n} from './transformers';\r\n\r\nimport {DatatableRenderer} from './renderer';\r\n\r\nconst panelDefaults = {\r\n    targets: [{}],\r\n    transform: 'timeseries_to_columns',\r\n    rowsPerPage: 5,\r\n    showHeader: true,\r\n    styles: [\r\n        {\r\n            type: 'date',\r\n            pattern: 'Time',\r\n            dateFormat: 'YYYY-MM-DD HH:mm:ss',\r\n        },\r\n        {\r\n            unit: 'short',\r\n            type: 'number',\r\n            decimals: 2,\r\n            colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\r\n            colorMode: null,\r\n            pattern: '/.*/',\r\n            thresholds: [],\r\n        }\r\n    ],\r\n    columns: [],\r\n    groupBy: [],\r\n    scroll: false,\r\n    scrollHeight: 'default',\r\n    fontSize: '100%',\r\n    sort: {\r\n        col: 0,\r\n        desc: true\r\n    },\r\n    sortDirection: 'desc',\r\n    datatableTheme: 'basic_theme',\r\n    themeOptions: {\r\n        light: './css/datatable-light.css',\r\n        dark: './css/datatable-dark.css'\r\n    },\r\n    rowNumbersEnabled: false,\r\n    infoEnabled: true,\r\n    searchEnabled: true,\r\n    showCellBorders: false,\r\n    showRowBorders: true,\r\n    hoverEnabled: true,\r\n    orderColumnEnabled: true,\r\n    compactRowsEnabled: false,\r\n    stripedRowsEnabled: true,\r\n    lengthChangeEnabled: true,\r\n    datatablePagingType: 'simple_numbers',\r\n    pagingTypes: [\r\n        {\r\n            text: 'Page number buttons only',\r\n            value: 'numbers',\r\n        },\r\n        {\r\n            text: \"'Previous' and 'Next' buttons only\",\r\n            value: 'simple'\r\n        },\r\n        {\r\n            text: \"'Previous' and 'Next' buttons, plus page numbers\",\r\n            value: 'simple_numbers'\r\n        },\r\n        {\r\n            text: \"'First', 'Previous', 'Next' and 'Last' buttons\",\r\n            value: 'full'\r\n        },\r\n        {\r\n            text: \"'First', 'Previous', 'Next' and 'Last' buttons, plus page numbers\",\r\n            value: 'full_numbers'\r\n        },\r\n        {\r\n            text: \"'First' and 'Last' buttons, plus page numbers\",\r\n            value: 'first_last_numbers'\r\n        }\r\n    ],\r\n    themes: [\r\n        {\r\n            value: 'basic_theme',\r\n            text: 'Basic',\r\n            disabled: false,\r\n        },\r\n        {\r\n            value: 'bootstrap_theme',\r\n            text: 'Bootstrap',\r\n            disabled: true,\r\n        },\r\n        {\r\n            value: 'foundation_theme',\r\n            text: 'Foundation',\r\n            disabled: true,\r\n        },\r\n        {\r\n            value: 'themeroller_theme',\r\n            text: 'ThemeRoller',\r\n            disabled: true,\r\n        }\r\n    ],\r\n    responsive: {\r\n        enable: false,\r\n        hiddenColumns: []\r\n    },\r\n    editor: {\r\n        enable: false,\r\n        create: false,\r\n        edit: false,\r\n        editSingle: false,\r\n        remove: false,\r\n        removeSingle: false\r\n    },\r\n    buttons: {\r\n        collection: false,\r\n        columnsToggle: false,\r\n        columnsVisibility: false,\r\n        columnToggle: false,\r\n        columnVisibility: false,\r\n        colvis: false,\r\n        colvisGroup: false,\r\n        colvisRestore: false,\r\n        copy: false,\r\n        copyHtml5: false,\r\n        print: false,\r\n        pageLength: false,\r\n        csv: false,\r\n        csvHtml5: false,\r\n        excel: false,\r\n        excelHtml5: false,\r\n        pdf: false,\r\n        pdfHtml5: false,\r\n        selectAll: false,\r\n        selectNone: false,\r\n        selectCells: false,\r\n        selectColumns: false,\r\n        selectRows: false\r\n    }\r\n};\r\n\r\nexport class DatatablePanelCtrl extends MetricsPanelCtrl {\r\n\r\n    constructor($scope, $injector, $http, $location, uiSegmentSrv, annotationsSrv) {\r\n        super($scope, $injector);\r\n\r\n        this.pageIndex = 0;\r\n        this.table = null;\r\n        this.dataRaw = [];\r\n        this.transformers = transformers;\r\n        this.annotationsSrv = annotationsSrv;\r\n        this.uiSegmentSrv = uiSegmentSrv;\r\n        // editor\r\n\r\n        this.addColumnSegment = uiSegmentSrv.newPlusButton();\r\n        this.addGroupBySegment = uiSegmentSrv.newPlusButton();\r\n        this.addHiddenColumnBySegment = uiSegmentSrv.newPlusButton();\r\n        this.fontSizes = ['80%', '90%', '100%', '110%', '120%', '130%', '150%', '160%', '180%', '200%', '220%', '250%'];\r\n        this.colorModes = [\r\n            {\r\n                text: 'Disabled',\r\n                value: null\r\n            },\r\n            {\r\n                text: 'Cell',\r\n                value: 'cell'\r\n            },\r\n            {\r\n                text: 'Value',\r\n                value: 'value'\r\n            },\r\n            {\r\n                text: 'Row',\r\n                value: 'row'\r\n            },\r\n            {\r\n                text: 'Row Column',\r\n                value: 'rowcolumn'\r\n            },\r\n        ];\r\n        this.columnTypes = [\r\n            {\r\n                text: 'Number',\r\n                value: 'number'\r\n            },\r\n            {\r\n                text: 'String',\r\n                value: 'string'\r\n            },\r\n            {\r\n                text: 'Date',\r\n                value: 'date'\r\n            },\r\n            {\r\n                text: 'Hidden',\r\n                value: 'hidden'\r\n            }\r\n        ];\r\n        this.unitFormats = kbn.getUnitFormats();\r\n        this.dateFormats = [\r\n            {\r\n                text: 'YYYY-MM-DD HH:mm:ss',\r\n                value: 'YYYY-MM-DD HH:mm:ss'\r\n            },\r\n            {\r\n                text: 'MM/DD/YY h:mm:ss a',\r\n                value: 'MM/DD/YY h:mm:ss a'\r\n            },\r\n            {\r\n                text: 'MMMM D, YYYY LT',\r\n                value: 'MMMM D, YYYY LT'\r\n            },\r\n        ];\r\n        this.sortDirections = [\"desc\", \"asc\"];\r\n        // this is used from bs-typeahead and needs to be instance bound\r\n        this.getColumnNames = () => {\r\n            if (!this.table) {\r\n                return [];\r\n            }\r\n            return _.map(this.table.columns, function (col) {\r\n                return col.text;\r\n            });\r\n        };\r\n\r\n        if (this.panel.styles === void 0) {\r\n            this.panel.styles = this.panel.columns;\r\n            this.panel.columns = this.panel.fields;\r\n            delete this.panel.columns;\r\n            delete this.panel.fields;\r\n        }\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        System.config({\r\n            paths: {\r\n                \"datatables.net\": this.getPanelPath() + \"libs/datatables.net/js/jquery.dataTables.min\",\r\n                \"datatables.net-bs\": this.getPanelPath() + \"libs/datatables.net-bs/js/dataTables.bootstrap.min\",\r\n                \"datatables.net-jqui\": this.getPanelPath() + \"libs/datatables.net-jqui/js/dataTables.jqueryui.min\",\r\n                \"datatables.net-zf\": this.getPanelPath() + \"libs/datatables.net-zf/js/dataTables.foundation.min\",\r\n                \"datatables.net-responsive\": this.getPanelPath() + \"libs/datatables.net-responsive/js/dataTables.responsive.min\",\r\n                \"datatables.net-buttons\": this.getPanelPath() + \"libs/datatables.net-buttons/js/dataTables.buttons\"\r\n            }\r\n        });\r\n\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-responsive/js/dataTables.responsive.min.js');\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-buttons/js/dataTables.buttons.min.js');\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-buttons/js/buttons.colVis.min.js');\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-buttons/js/buttons.html5.min.js');\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-buttons/js/buttons.print.min.js');\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-select/js/dataTables.select.min.js');\r\n\r\n        // basic datatables theme\r\n        // alternative themes are disabled since they affect all datatable panels on same page currently\r\n        switch (this.panel.datatableTheme) {\r\n            case 'basic_theme':\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-dt/css/jquery.dataTables.min.css!');\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-responsive-dt/css/responsive.dataTables.min.css!');\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-buttons-dt/css/buttons.dataTables.min.css!');\r\n\r\n                if (grafanaBootData.user.lightTheme) {\r\n                    System.import(this.getPanelPath() + this.panel.themeOptions.light + '!css');\r\n                } else {\r\n                    System.import(this.getPanelPath() + this.panel.themeOptions.dark + \"!css\");\r\n                }\r\n                break;\r\n            case 'bootstrap_theme':\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-bs/js/dataTables.bootstrap.min.js');\r\n                System.import(this.getPanelPath() + 'libs/bootstrap/dist/css/prefixed-bootstrap.min.css!');\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-bs/css/dataTables.bootstrap.min.css!');\r\n                if (!grafanaBootData.user.lightTheme) {\r\n                    System.import(this.getPanelPath() + 'css/prefixed-bootstrap-slate.min.css!');\r\n                }\r\n                break;\r\n            case 'foundation_theme':\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-zf/js/dataTables.foundation.min.js');\r\n                System.import(this.getPanelPath() + 'libs/foundation/css/prefixed-foundation.min.css!');\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-zf/css/dataTables.foundation.min.css!');\r\n                break;\r\n            case 'themeroller_theme':\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-jqui/js/dataTables.jqueryui.min.js');\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-jqui/css/dataTables.jqueryui.min.css!');\r\n                System.import(this.getPanelPath() + 'css/jquery-ui-smoothness.css!');\r\n                break;\r\n            default:\r\n                System.import(this.getPanelPath() + 'libs/datatables.net-dt/css/jquery.dataTables.min.css!');\r\n                if (grafanaBootData.user.lightTheme) {\r\n                    System.import(this.getPanelPath() + this.panel.themeOptions.light + '!css');\r\n                } else {\r\n                    System.import(this.getPanelPath() + this.panel.themeOptions.dark + \"!css\");\r\n                }\r\n                break;\r\n        }\r\n        this.dataLoaded = true;\r\n        this.http = $http;\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\r\n    }\r\n\r\n    onInitPanelActions(actions) {\r\n        actions.push({\r\n            text: 'Export CSV',\r\n            click: 'ctrl.exportCsv()'\r\n        });\r\n    }\r\n\r\n    // setup the editor\r\n    onInitEditMode() {\r\n        // determine the path to this plugin\r\n        var panels = grafanaBootData.settings.panels;\r\n        var thisPanel = panels[this.pluginId];\r\n        var thisPanelPath = thisPanel.baseUrl + '/';\r\n        // add the relative path to the partial\r\n        var optionsPath = thisPanelPath + 'partials/editor.options.html';\r\n        this.addEditorTab('Options', optionsPath, 2);\r\n        var datatableOptionsPath = thisPanelPath + 'partials/datatables.options.html';\r\n        this.addEditorTab('Datatable Options', datatableOptionsPath, 3);\r\n    }\r\n\r\n    getPanelPath() {\r\n        var panels = grafanaBootData.settings.panels;\r\n        var thisPanel = panels[this.pluginId];\r\n        // the system loader preprends publib to the url, add a .. to go back one level\r\n        var thisPanelPath = '../' + thisPanel.baseUrl + '/';\r\n        return thisPanelPath;\r\n    }\r\n\r\n    issueQueries(datasource) {\r\n        this.pageIndex = 0;\r\n        if (this.panel.transform === 'annotations') {\r\n            this.setTimeQueryStart();\r\n            return this.annotationsSrv.getAnnotations({\r\n                dashboard: this.dashboard,\r\n                panel: this.panel,\r\n                range: this.range\r\n            })\r\n                .then(annotations => {\r\n                    return {\r\n                        data: annotations\r\n                    };\r\n                });\r\n        }\r\n        return super.issueQueries(datasource);\r\n    }\r\n\r\n    onDataError(err) {\r\n        this.dataRaw = [];\r\n        this.render();\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n        this.dataRaw = dataList;\r\n        this.pageIndex = 0;\r\n\r\n        // automatically correct transform mode based on data\r\n        if (this.dataRaw && this.dataRaw.length) {\r\n            if (this.dataRaw[0].type === 'table') {\r\n                this.panel.transform = 'table';\r\n            } else {\r\n                if (this.dataRaw[0].type === 'docs') {\r\n                    this.panel.transform = 'json';\r\n                } else {\r\n                    if (this.panel.transform === 'table' || this.panel.transform === 'json') {\r\n                        this.panel.transform = 'timeseries_to_rows';\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.render();\r\n    }\r\n\r\n    render() {\r\n        this.table = transformDataToTable(this.dataRaw, this.panel);\r\n        this.table.sort(this.panel.sort);\r\n        return super.render(this.table);\r\n    }\r\n\r\n    getPanelHeight() {\r\n        // panel can have a fixed height via options\r\n        var tmpPanelHeight = this.$scope.ctrl.panel.height;\r\n        // if that is blank, try to get it from our row\r\n        if (typeof tmpPanelHeight === 'undefined') {\r\n            // get from the row instead\r\n            tmpPanelHeight = this.row.height;\r\n            // default to 250px if that was undefined also\r\n            if (typeof tmpPanelHeight === 'undefined') {\r\n                tmpPanelHeight = 250;\r\n            }\r\n        }\r\n        else {\r\n            // convert to numeric value\r\n            tmpPanelHeight = tmpPanelHeight.replace(\"px\", \"\");\r\n        }\r\n        var actualHeight = parseInt(tmpPanelHeight);\r\n        // grafana minimum height for a panel is 250px\r\n        if (actualHeight < 250) {\r\n            actualHeight = 250;\r\n        }\r\n        return actualHeight;\r\n    }\r\n\r\n    exportCsv() {\r\n        var renderer = new DatatableRenderer(this.panel, this.table, this.dashboard.isTimezoneUtc(), this.$sanitize, this.$injector.get('linkSrv'));\r\n        FileExport.exportTableDataToCsv(renderer.render_values());\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        var data;\r\n        var panel = ctrl.panel;\r\n        var formatters = [];\r\n        var _this = this;\r\n\r\n        /**\r\n         * [renderPanel description]\r\n         * @return {[type]} [description]\r\n         */\r\n        function renderPanel() {\r\n            var renderer = new DatatableRenderer(panel, ctrl.table, ctrl.dashboard.isTimezoneUtc(), ctrl.$sanitize, ctrl.$injector.get('linkSrv'));\r\n            renderer.render();\r\n            _this.dataLoaded = true;\r\n        }\r\n\r\n        ctrl.panel.panelHeight = this.getPanelHeight();\r\n        ctrl.events.on('render', function (renderData) {\r\n            data = renderData || data;\r\n            if (data) {\r\n                renderPanel();\r\n            }\r\n            ctrl.renderingCompleted();\r\n        });\r\n    }\r\n\r\n    // editor methods\r\n    //\r\n    // cell and row borders cannot both be set at the same time\r\n    showCellBordersChanged() {\r\n        if (this.panel.showCellBorders) {\r\n            this.panel.showRowBorders = false;\r\n        }\r\n        this.render();\r\n    }\r\n\r\n    themeChanged() {\r\n        //console.log(this.panel.datatableTheme);\r\n        this.render();\r\n    }\r\n\r\n    transformChanged() {\r\n        this.panel.columns = [];\r\n        this.panel.groupBy = [];\r\n        this.render();\r\n    }\r\n\r\n    removeColumn(column) {\r\n        this.panel.columns = _.without(this.panel.columns, column);\r\n        this.render();\r\n    }\r\n\r\n    removeGroupBy(column) {\r\n        this.panel.groupBy = _.without(this.panel.groupBy, column);\r\n        this.render();\r\n    }\r\n\r\n    removeHiddenColumns(column) {\r\n        this.panel.responsive.hiddenColumns = _.without(this.panel.responsive.hiddenColumns, column);\r\n        this.render();\r\n    }\r\n\r\n    getColumnOptions() {\r\n        if (!this.dataRaw) {\r\n            return this.$q.when([]);\r\n        }\r\n        var columns = this.transformers[this.panel.transform].getColumns(this.dataRaw);\r\n        var segments = _.map(columns, (c) => this.uiSegmentSrv.newSegment({\r\n            value: c.text\r\n        }));\r\n        return this.$q.when(segments);\r\n    }\r\n\r\n    addColumn() {\r\n        var columns = transformers[this.panel.transform].getColumns(this.dataRaw);\r\n        var column = _.find(columns, {\r\n            text: this.addColumnSegment.value\r\n        });\r\n\r\n        if (column) {\r\n            this.panel.columns.push(column);\r\n\r\n        } else {\r\n            this.panel.columns.push({text: this.addColumnSegment.value, value: this.addColumnSegment.value});\r\n        }\r\n        this.render();\r\n\r\n        var plusButton = this.uiSegmentSrv.newPlusButton();\r\n        this.addColumnSegment.html = plusButton.html;\r\n        this.addColumnSegment.value = plusButton.value;\r\n    }\r\n\r\n    addGroupBy() {\r\n        var columns = transformers[this.panel.transform].getColumns(this.dataRaw);\r\n        var column = _.find(columns, {\r\n            text: this.addGroupBySegment.value\r\n        });\r\n\r\n        if (column) {\r\n            this.panel.groupBy.push(column);\r\n            this.render();\r\n        }\r\n\r\n        var plusButton = this.uiSegmentSrv.newPlusButton();\r\n        this.addGroupBySegment.html = plusButton.html;\r\n        this.addGroupBySegment.value = plusButton.value;\r\n    }\r\n\r\n    addHiddenColumn() {\r\n        var columns = transformers[this.panel.transform].getColumns(this.dataRaw);\r\n        var column = _.find(columns, {\r\n            text: this.addHiddenColumnBySegment.value\r\n        });\r\n\r\n        if (column) {\r\n            this.panel.responsive.hiddenColumns.push(column);\r\n            this.render();\r\n        }\r\n\r\n        var plusButton = this.uiSegmentSrv.newPlusButton();\r\n        this.addHiddenColumnBySegment.html = plusButton.html;\r\n        this.addHiddenColumnBySegment.value = plusButton.value;\r\n    }\r\n\r\n    addColumnStyle() {\r\n        var columnStyleDefaults = {\r\n            unit: 'short',\r\n            type: 'number',\r\n            decimals: 2,\r\n            colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\r\n            colorMode: null,\r\n            pattern: '/.*/',\r\n            dateFormat: 'YYYY-MM-DD HH:mm:ss',\r\n            thresholds: [],\r\n        };\r\n        this.panel.styles.push(angular.copy(columnStyleDefaults));\r\n    }\r\n\r\n    removeColumnStyle(style) {\r\n        this.panel.styles = _.without(this.panel.styles, style);\r\n    }\r\n\r\n    setUnitFormat(column, subItem) {\r\n        column.unit = subItem.value;\r\n        this.render();\r\n    }\r\n\r\n    invertColorOrder(index) {\r\n        var ref = this.panel.styles[index].colors;\r\n        var copy = ref[0];\r\n        ref[0] = ref[2];\r\n        ref[2] = copy;\r\n        this.render();\r\n    }\r\n}\r\n\r\nDatatablePanelCtrl.templateUrl = 'partials/template.html';\r\n"]}